#!/bin/bash
# clone/update Github Repo 

printf "        \033[34m clone/update Github Repo Tool \033[0m \n"

if [[ -d GithubRepo ]];then
    echo -e "\033[35må³å°†ä¸‹è½½å·²é…ç½®çš„Repoåˆ°æœ¬åœ°ã€‚\033[0m"
else
    
    echo -e "\033[36m\né¦–æ¬¡æ£€å‡ºGitHub Repoï¼Œå·²ä¸ºæ‚¨è‡ªåŠ¨å¤„ç†å­ç»„ä»¶ä»“åº“ä¸»ç›®å½•. \033[0m"
    echo -e "\033[35mè¯·è¾“å…¥æ‚¨çš„é‚®ç®±ä¿¡æ¯ \033[0m"
    
    read coding_code_email   

    # coding_code_name=${coding_code_email%@*} >/dev/null 2>&1
    coding_code_name='DevDragonLi' >/dev/null 2>&1
    echo -e "\033[36mæ‚¨è¾“å…¥çš„GitHub Repoé…ç½®ä¿¡æ¯å¦‚ä¸‹â¬‡ï¸\n\n\033[34mEmail :\033[32m${coding_code_email}\n\033[34mAuthor:\033[32m${coding_code_name}\033[0m"
    mkdir GithubRepo
fi 

echo -e "\033[35m\nBegain clone/update GitHub Repo ! Please Waiting â˜•ï¸\033[0m"

if [[ -d .config ]];then
    echo 
else
   	echo -e "\033[31mæ— æ³•è¯»å–ä¾èµ–é…ç½®ä¿¡æ¯ï¼ŒåŒæ­¥ç»ˆæ­¢ï¼\033[0m" 
    exit 0  
fi

coding_ssh_url=`head -n +1 .config/codingrooturl` 

cat ./.config/repoNameList | while read pod_name ;do

    if [[ -d GithubRepo/${pod_name} ]]; then

        (cd GithubRepo/${pod_name} && git stash  >/dev/null 2>&1 && git pull --rebase >/dev/null 2>&1 && git stash pop  >/dev/null 2>&1)   
       
        cd GithubRepo/${pod_name}
        # (cp -f  ../../subPodconfig/pre-commit .git/hooks/pre-commit)
        
        this_pod_git_name=`git config --local user.name` 

        if [ -n "$this_pod_git_name" ];then
            echo -e "\033[36mHello ${this_pod_git_name} : \033[34m${pod_name}Repoå·²åŒæ­¥å®Œæˆï¼ï¼ï¼\033[0m"
        else
            #æœªé…ç½®
            echo -e "\033[34m   ${pod_name}Repoå·²åŒæ­¥å®Œæˆï¼ï¼ï¼\n\033[0m"
            echo -e "\033[31m${pod_name} Git Info unSettingsï¼ŒPlease following below cmd run by Youselfï¼\n 1.config user.name xxx\n 2.config user.email xxx\033[0m"
        fi

        cd ../../
    else
        (cd GithubRepo && git clone ${coding_ssh_url}${pod_name}  >/dev/null 2>&1 && cd ${pod_name} && git config user.email $coding_code_email && git config user.name $coding_code_name )
        
        echo -e "\033[35mðŸš´æœ¬åœ°ç¼ºå¤±çš„${pod_name}Repo,å·²ä¸‹è½½å®Œæ¯•ã€‚\033[0m"
    fi 

done

